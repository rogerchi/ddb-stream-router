<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@rogerchi/ddb-stream-router</title><meta name="description" content="Documentation for @rogerchi/ddb-stream-router"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><script async src="assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">@rogerchi/ddb-stream-router</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>@rogerchi/ddb-stream-router</h1></div><div class="tsd-panel tsd-typography"><h1 id="ddb-stream-router" class="tsd-anchor-link">ddb-stream-router<a href="#ddb-stream-router" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>A TypeScript library providing Express-like routing for DynamoDB Stream events. Register type-safe handlers for INSERT, MODIFY, and REMOVE operations using discriminator functions or schema validators like Zod. Defer heavy processing to SQS with a simple <code>.defer(handlerId)</code> chain to keep your stream processing fast and reliable.</p>
<h2 id="features" class="tsd-anchor-link">Features<a href="#features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><strong>Express-like API</strong> - Familiar <code>.onInsert()</code>, <code>.onModify()</code>, <code>.onRemove()</code>, <code>.use()</code> methods</li>
<li><strong>Type Safety</strong> - Full TypeScript inference from discriminators and parsers</li>
<li><strong>Flexible Matching</strong> - Use type guards or schema validators (Zod, etc.)</li>
<li><strong>Attribute Filtering</strong> - React to specific attribute changes in MODIFY events</li>
<li><strong>Batch Processing</strong> - Group records and process them together</li>
<li><strong>Middleware Support</strong> - Intercept records before handlers</li>
<li><strong>Deferred Processing</strong> - Automatically enqueue to SQS for async processing</li>
<li><strong>Global Tables</strong> - Filter records by region</li>
<li><strong>Partial Batch Failures</strong> - Lambda retry support via <code>reportBatchItemFailures</code></li>
</ul>
<h2 id="installation" class="tsd-anchor-link">Installation<a href="#installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">ddb-stream-router</span><br/><span class="hl-3"># or</span><br/><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1"> </span><span class="hl-2">ddb-stream-router</span>
</code><button type="button">Copy</button></pre>

<p><strong>Peer dependencies:</strong></p>
<pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">@aws-sdk/util-dynamodb</span><span class="hl-1"> </span><span class="hl-2">@aws-sdk/client-sqs</span>
</code><button type="button">Copy</button></pre>

<h2 id="quick-start" class="tsd-anchor-link">Quick Start<a href="#quick-start" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">StreamRouter</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;ddb-stream-router&#39;</span><span class="hl-1">;</span><br/><span class="hl-4">import</span><span class="hl-1"> </span><span class="hl-4">type</span><span class="hl-1"> { </span><span class="hl-5">DynamoDBStreamHandler</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;aws-lambda&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-7">User</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">pk</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">sk</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">name</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">email</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">// Type guard discriminator</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-0">isUser</span><span class="hl-1"> = (</span><span class="hl-5">record</span><span class="hl-1">: </span><span class="hl-7">unknown</span><span class="hl-1">): </span><span class="hl-5">record</span><span class="hl-1"> </span><span class="hl-6">is</span><span class="hl-1"> </span><span class="hl-7">User</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><br/><span class="hl-1">  </span><span class="hl-6">typeof</span><span class="hl-1"> </span><span class="hl-5">record</span><span class="hl-1"> === </span><span class="hl-2">&#39;object&#39;</span><span class="hl-1"> &amp;&amp;</span><br/><span class="hl-1">  </span><span class="hl-5">record</span><span class="hl-1"> !== </span><span class="hl-6">null</span><span class="hl-1"> &amp;&amp;</span><br/><span class="hl-1">  </span><span class="hl-2">&#39;pk&#39;</span><span class="hl-1"> </span><span class="hl-6">in</span><span class="hl-1"> </span><span class="hl-5">record</span><span class="hl-1"> &amp;&amp;</span><br/><span class="hl-1">  (</span><span class="hl-5">record</span><span class="hl-1"> </span><span class="hl-4">as</span><span class="hl-1"> { </span><span class="hl-5">pk</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1"> }).</span><span class="hl-5">pk</span><span class="hl-1">.</span><span class="hl-0">startsWith</span><span class="hl-1">(</span><span class="hl-2">&#39;USER#&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">router</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">StreamRouter</span><span class="hl-1">();</span><br/><br/><span class="hl-5">router</span><br/><span class="hl-1">  .</span><span class="hl-0">onInsert</span><span class="hl-1">(</span><span class="hl-5">isUser</span><span class="hl-1">, </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">newUser</span><span class="hl-1">, </span><span class="hl-5">ctx</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`User created: </span><span class="hl-6">${</span><span class="hl-5">newUser</span><span class="hl-9">.</span><span class="hl-5">name</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">  .</span><span class="hl-0">onModify</span><span class="hl-1">(</span><span class="hl-5">isUser</span><span class="hl-1">, </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">oldUser</span><span class="hl-1">, </span><span class="hl-5">newUser</span><span class="hl-1">, </span><span class="hl-5">ctx</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`User updated: </span><span class="hl-6">${</span><span class="hl-5">oldUser</span><span class="hl-9">.</span><span class="hl-5">name</span><span class="hl-6">}</span><span class="hl-2"> -&gt; </span><span class="hl-6">${</span><span class="hl-5">newUser</span><span class="hl-9">.</span><span class="hl-5">name</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">  .</span><span class="hl-0">onRemove</span><span class="hl-1">(</span><span class="hl-5">isUser</span><span class="hl-1">, </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">deletedUser</span><span class="hl-1">, </span><span class="hl-5">ctx</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`User deleted: </span><span class="hl-6">${</span><span class="hl-5">deletedUser</span><span class="hl-9">.</span><span class="hl-5">name</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-3">// Simplified export with built-in batch failure support</span><br/><span class="hl-4">export</span><span class="hl-1"> </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">handler</span><span class="hl-1"> = </span><span class="hl-5">router</span><span class="hl-1">.</span><span class="hl-5">streamHandler</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// Or with custom options:</span><br/><span class="hl-3">// export const handler: DynamoDBStreamHandler = async (event) =&gt; {</span><br/><span class="hl-3">//   return router.process(event, { reportBatchItemFailures: true });</span><br/><span class="hl-3">// };</span>
</code><button type="button">Copy</button></pre>

<h2 id="discriminator-matching" class="tsd-anchor-link">Discriminator Matching<a href="#discriminator-matching" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The discriminator/parser is matched against different images based on event type:</p>
<table>
<thead>
<tr>
<th>Event Type</th>
<th>Image Used for Matching</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>INSERT</code></td>
<td>newImage</td>
</tr>
<tr>
<td><code>MODIFY</code></td>
<td>newImage</td>
</tr>
<tr>
<td><code>REMOVE</code></td>
<td>oldImage</td>
</tr>
</tbody>
</table>
<p>For MODIFY events, the <strong>newImage</strong> is used for matching because you typically want to route based on the current state of the record. If a record's type changed (e.g., <code>pk</code> prefix changed from <code>USER#</code> to <code>ADMIN#</code>), the handler for the new type will be invoked.</p>
<h2 id="using-zod-schemas" class="tsd-anchor-link">Using Zod Schemas<a href="#using-zod-schemas" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">z</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;zod&#39;</span><span class="hl-1">;</span><br/><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">StreamRouter</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;ddb-stream-router&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">UserSchema</span><span class="hl-1"> = </span><span class="hl-5">z</span><span class="hl-1">.</span><span class="hl-0">object</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">pk:</span><span class="hl-1"> </span><span class="hl-5">z</span><span class="hl-1">.</span><span class="hl-0">string</span><span class="hl-1">().</span><span class="hl-0">startsWith</span><span class="hl-1">(</span><span class="hl-2">&#39;USER#&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-5">sk:</span><span class="hl-1"> </span><span class="hl-5">z</span><span class="hl-1">.</span><span class="hl-0">string</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-5">name:</span><span class="hl-1"> </span><span class="hl-5">z</span><span class="hl-1">.</span><span class="hl-0">string</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-5">email:</span><span class="hl-1"> </span><span class="hl-5">z</span><span class="hl-1">.</span><span class="hl-0">string</span><span class="hl-1">(),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-7">User</span><span class="hl-1"> = </span><span class="hl-7">z</span><span class="hl-1">.</span><span class="hl-7">infer</span><span class="hl-1">&lt;</span><span class="hl-6">typeof</span><span class="hl-1"> </span><span class="hl-5">UserSchema</span><span class="hl-1">&gt;;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">router</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">StreamRouter</span><span class="hl-1">();</span><br/><br/><span class="hl-3">// Schema validates and parses data before handler receives it</span><br/><span class="hl-5">router</span><span class="hl-1">.</span><span class="hl-0">onInsert</span><span class="hl-1">(</span><span class="hl-5">UserSchema</span><span class="hl-1">, </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">newUser</span><span class="hl-1">: </span><span class="hl-7">User</span><span class="hl-1">, </span><span class="hl-5">ctx</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">// newUser is guaranteed to match the schema</span><br/><span class="hl-1">  </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Valid user: </span><span class="hl-6">${</span><span class="hl-5">newUser</span><span class="hl-9">.</span><span class="hl-5">email</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h2 id="attribute-change-filtering" class="tsd-anchor-link">Attribute Change Filtering<a href="#attribute-change-filtering" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>React only when specific attributes change:</p>
<pre><code class="typescript"><span class="hl-3">// Only trigger when email changes</span><br/><span class="hl-5">router</span><span class="hl-1">.</span><span class="hl-0">onModify</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-5">isUser</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">oldUser</span><span class="hl-1">, </span><span class="hl-5">newUser</span><span class="hl-1">, </span><span class="hl-5">ctx</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">sendEmailVerification</span><span class="hl-1">(</span><span class="hl-5">newUser</span><span class="hl-1">.</span><span class="hl-5">email</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  { </span><span class="hl-5">attribute:</span><span class="hl-1"> </span><span class="hl-2">&#39;email&#39;</span><span class="hl-1">, </span><span class="hl-5">changeType:</span><span class="hl-1"> </span><span class="hl-2">&#39;changed_attribute&#39;</span><span class="hl-1"> }</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-3">// Nested attributes with dot notation</span><br/><span class="hl-5">router</span><span class="hl-1">.</span><span class="hl-0">onModify</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-5">isUser</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">oldUser</span><span class="hl-1">, </span><span class="hl-5">newUser</span><span class="hl-1">, </span><span class="hl-5">ctx</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Theme: </span><span class="hl-6">${</span><span class="hl-5">oldUser</span><span class="hl-9">.</span><span class="hl-5">preferences</span><span class="hl-9">.</span><span class="hl-5">theme</span><span class="hl-6">}</span><span class="hl-2"> -&gt; </span><span class="hl-6">${</span><span class="hl-5">newUser</span><span class="hl-9">.</span><span class="hl-5">preferences</span><span class="hl-9">.</span><span class="hl-5">theme</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  { </span><span class="hl-5">attribute:</span><span class="hl-1"> </span><span class="hl-2">&#39;preferences.theme&#39;</span><span class="hl-1">, </span><span class="hl-5">changeType:</span><span class="hl-1"> </span><span class="hl-2">&#39;changed_attribute&#39;</span><span class="hl-1"> }</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-3">// Watching parent catches all nested changes</span><br/><span class="hl-5">router</span><span class="hl-1">.</span><span class="hl-0">onModify</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-5">isUser</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">oldUser</span><span class="hl-1">, </span><span class="hl-5">newUser</span><span class="hl-1">, </span><span class="hl-5">ctx</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">// Triggers when preferences.theme OR preferences.notifications changes</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Any preference changed&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  { </span><span class="hl-5">attribute:</span><span class="hl-1"> </span><span class="hl-2">&#39;preferences&#39;</span><span class="hl-1"> }</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-3">// Trigger when tags are added to a collection</span><br/><span class="hl-5">router</span><span class="hl-1">.</span><span class="hl-0">onModify</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-5">isUser</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">oldUser</span><span class="hl-1">, </span><span class="hl-5">newUser</span><span class="hl-1">, </span><span class="hl-5">ctx</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;New tags added&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  { </span><span class="hl-5">attribute:</span><span class="hl-1"> </span><span class="hl-2">&#39;tags&#39;</span><span class="hl-1">, </span><span class="hl-5">changeType:</span><span class="hl-1"> </span><span class="hl-2">&#39;new_item_in_collection&#39;</span><span class="hl-1"> }</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-3">// Multiple change types (OR logic)</span><br/><span class="hl-5">router</span><span class="hl-1">.</span><span class="hl-0">onModify</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-5">isUser</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">oldUser</span><span class="hl-1">, </span><span class="hl-5">newUser</span><span class="hl-1">, </span><span class="hl-5">ctx</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Tags modified&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  { </span><span class="hl-5">attribute:</span><span class="hl-1"> </span><span class="hl-2">&#39;tags&#39;</span><span class="hl-1">, </span><span class="hl-5">changeType:</span><span class="hl-1"> [</span><span class="hl-2">&#39;new_item_in_collection&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;remove_item_from_collection&#39;</span><span class="hl-1">] }</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>Change types:</strong></p>
<ul>
<li><code>new_attribute</code> - Attribute added</li>
<li><code>remove_attribute</code> - Attribute removed</li>
<li><code>changed_attribute</code> - Attribute value changed</li>
<li><code>new_item_in_collection</code> - Item added to List or Set (SS/NS/BS)</li>
<li><code>remove_item_from_collection</code> - Item removed from List or Set</li>
<li><code>changed_item_in_collection</code> - Items both added and removed in List/Set</li>
</ul>
<p><strong>Supported collection types:</strong></p>
<ul>
<li>Arrays (DynamoDB Lists)</li>
<li>Sets (DynamoDB String Sets, Number Sets, Binary Sets)</li>
</ul>
<h2 id="batch-processing" class="tsd-anchor-link">Batch Processing<a href="#batch-processing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Process multiple records together:</p>
<pre><code class="typescript"><span class="hl-3">// All matching records in one handler call</span><br/><span class="hl-5">router</span><span class="hl-1">.</span><span class="hl-0">onInsert</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-5">isInventoryChange</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">records</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Processing </span><span class="hl-6">${</span><span class="hl-5">records</span><span class="hl-9">.</span><span class="hl-5">length</span><span class="hl-6">}</span><span class="hl-2"> changes`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">for</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> { </span><span class="hl-8">newImage</span><span class="hl-1">, </span><span class="hl-8">ctx</span><span class="hl-1"> } </span><span class="hl-6">of</span><span class="hl-1"> </span><span class="hl-5">records</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">// process each record</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  { </span><span class="hl-5">batch:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1"> }</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-3">// Group by attribute value</span><br/><span class="hl-5">router</span><span class="hl-1">.</span><span class="hl-0">onInsert</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-5">isAuditLog</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">records</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">userId</span><span class="hl-1"> = </span><span class="hl-5">records</span><span class="hl-1">[</span><span class="hl-10">0</span><span class="hl-1">].</span><span class="hl-5">newImage</span><span class="hl-1">.</span><span class="hl-5">userId</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><span class="hl-6">${</span><span class="hl-5">records</span><span class="hl-9">.</span><span class="hl-5">length</span><span class="hl-6">}</span><span class="hl-2"> logs for user </span><span class="hl-6">${</span><span class="hl-5">userId</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  { </span><span class="hl-5">batch:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">, </span><span class="hl-5">batchKey:</span><span class="hl-1"> </span><span class="hl-2">&#39;userId&#39;</span><span class="hl-1"> }</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-3">// Group by primary key</span><br/><span class="hl-5">router</span><span class="hl-1">.</span><span class="hl-0">onModify</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-5">isItem</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">records</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">// All records for the same pk+sk</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  { </span><span class="hl-5">batch:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">, </span><span class="hl-5">batchKey:</span><span class="hl-1"> { </span><span class="hl-5">partitionKey:</span><span class="hl-1"> </span><span class="hl-2">&#39;pk&#39;</span><span class="hl-1">, </span><span class="hl-5">sortKey:</span><span class="hl-1"> </span><span class="hl-2">&#39;sk&#39;</span><span class="hl-1"> } }</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<h2 id="middleware" class="tsd-anchor-link">Middleware<a href="#middleware" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-3">// Logging middleware</span><br/><span class="hl-5">router</span><span class="hl-1">.</span><span class="hl-0">use</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">record</span><span class="hl-1">, </span><span class="hl-5">next</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Processing </span><span class="hl-6">${</span><span class="hl-5">record</span><span class="hl-9">.</span><span class="hl-5">eventName</span><span class="hl-6">}</span><span class="hl-2">: </span><span class="hl-6">${</span><span class="hl-5">record</span><span class="hl-9">.</span><span class="hl-5">eventID</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">next</span><span class="hl-1">();</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Skip certain records</span><br/><span class="hl-5">router</span><span class="hl-1">.</span><span class="hl-0">use</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">record</span><span class="hl-1">, </span><span class="hl-5">next</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-5">record</span><span class="hl-1">.</span><span class="hl-5">eventSourceARN</span><span class="hl-1">?.</span><span class="hl-0">includes</span><span class="hl-1">(</span><span class="hl-2">&#39;test-table&#39;</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-4">return</span><span class="hl-1">; </span><span class="hl-3">// Don&#39;t call next() to skip</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">next</span><span class="hl-1">();</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Error handling</span><br/><span class="hl-5">router</span><span class="hl-1">.</span><span class="hl-0">use</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">record</span><span class="hl-1">, </span><span class="hl-5">next</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">next</span><span class="hl-1">();</span><br/><span class="hl-1">  } </span><span class="hl-4">catch</span><span class="hl-1"> (</span><span class="hl-5">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">recordMetric</span><span class="hl-1">(</span><span class="hl-2">&#39;stream.error&#39;</span><span class="hl-1">, </span><span class="hl-10">1</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">throw</span><span class="hl-1"> </span><span class="hl-5">error</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h2 id="deferred-processing-sqs" class="tsd-anchor-link">Deferred Processing (SQS)<a href="#deferred-processing-sqs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Offload heavy processing to SQS:</p>
<pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">SQSClient</span><span class="hl-1">, </span><span class="hl-5">SendMessageCommand</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@aws-sdk/client-sqs&#39;</span><span class="hl-1">;</span><br/><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">StreamRouter</span><span class="hl-1">, </span><span class="hl-5">createSQSClient</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;ddb-stream-router&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">router</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">StreamRouter</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">deferQueue:</span><span class="hl-1"> </span><span class="hl-5">process</span><span class="hl-1">.</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-8">DEFER_QUEUE_URL</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">sqsClient:</span><span class="hl-1"> </span><span class="hl-0">createSQSClient</span><span class="hl-1">(</span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SQSClient</span><span class="hl-1">({}), </span><span class="hl-5">SendMessageCommand</span><span class="hl-1">),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Immediate handler</span><br/><span class="hl-5">router</span><span class="hl-1">.</span><span class="hl-0">onInsert</span><span class="hl-1">(</span><span class="hl-5">isOrder</span><span class="hl-1">, </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">order</span><span class="hl-1">, </span><span class="hl-5">ctx</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Order received&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Deferred handler - enqueues to SQS</span><br/><span class="hl-5">router</span><br/><span class="hl-1">  .</span><span class="hl-0">onInsert</span><span class="hl-1">(</span><span class="hl-5">isOrder</span><span class="hl-1">, </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">order</span><span class="hl-1">, </span><span class="hl-5">ctx</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">// This runs when processing from SQS</span><br/><span class="hl-1">    </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">sendConfirmationEmail</span><span class="hl-1">(</span><span class="hl-5">order</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">generateInvoice</span><span class="hl-1">(</span><span class="hl-5">order</span><span class="hl-1">);</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">  .</span><span class="hl-0">defer</span><span class="hl-1">(</span><span class="hl-2">&#39;order-email-handler&#39;</span><span class="hl-1">, { </span><span class="hl-5">delaySeconds:</span><span class="hl-1"> </span><span class="hl-10">30</span><span class="hl-1"> });</span><br/><br/><span class="hl-3">// Stream handler - simplified export with built-in batch failure support</span><br/><span class="hl-4">export</span><span class="hl-1"> </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">streamHandler</span><span class="hl-1"> = </span><span class="hl-5">router</span><span class="hl-1">.</span><span class="hl-5">streamHandler</span><span class="hl-1">;</span><br/><br/><span class="hl-3">// SQS handler - simplified export with built-in batch failure support</span><br/><span class="hl-4">export</span><span class="hl-1"> </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">sqsHandler</span><span class="hl-1"> = </span><span class="hl-5">router</span><span class="hl-1">.</span><span class="hl-5">sqsHandler</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p><strong>Why is the handler ID required?</strong></p>
<p>The <code>id</code> parameter in <code>.defer(id)</code> serves several important purposes:</p>
<ol>
<li>
<p><strong>Handler matching</strong>: When the SQS message is processed via <code>processDeferred()</code>, the ID identifies which specific handler should execute. This ensures only the intended handler runs, even if the original record matched multiple handlers.</p>
</li>
<li>
<p><strong>Stable references</strong>: The ID remains stable across Lambda deployments and code changes. Without a stable ID, handler registration order changes could route messages to the wrong handler.</p>
</li>
<li>
<p><strong>Cross-function support</strong>: The stream handler and SQS handler can be different Lambda functions. The ID ensures the SQS handler can locate the correct handler regardless of how handlers are registered in each function.</p>
</li>
<li>
<p><strong>Uniqueness</strong>: Each deferred handler must have a unique ID within the router. Duplicate IDs will throw a <code>ConfigurationError</code>.</p>
</li>
</ol>
<h2 id="global-tables-region-filtering" class="tsd-anchor-link">Global Tables (Region Filtering)<a href="#global-tables-region-filtering" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Process only records from the current region:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">router</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">StreamRouter</span><span class="hl-1">({ </span><span class="hl-5">sameRegionOnly:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<h2 id="configuration-options" class="tsd-anchor-link">Configuration Options<a href="#configuration-options" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">router</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">StreamRouter</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">// Stream view type (default: &#39;NEW_AND_OLD_IMAGES&#39;)</span><br/><span class="hl-1">  </span><span class="hl-5">streamViewType:</span><span class="hl-1"> </span><span class="hl-2">&#39;NEW_AND_OLD_IMAGES&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">// Auto-unmarshall DynamoDB JSON (default: true)</span><br/><span class="hl-1">  </span><span class="hl-5">unmarshall:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">// Only process same-region records (default: false)</span><br/><span class="hl-1">  </span><span class="hl-5">sameRegionOnly:</span><span class="hl-1"> </span><span class="hl-6">false</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">// Default SQS queue for deferred handlers</span><br/><span class="hl-1">  </span><span class="hl-5">deferQueue:</span><span class="hl-1"> </span><span class="hl-2">&#39;https://sqs...&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">// SQS client for deferred processing</span><br/><span class="hl-1">  </span><span class="hl-5">sqsClient:</span><span class="hl-1"> { </span><span class="hl-0">sendMessage</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-5">params</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> { ... } },</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">// Return batchItemFailures format for streamHandler/sqsHandler (default: true)</span><br/><span class="hl-1">  </span><span class="hl-5">reportBatchItemFailures:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-3">// Optional logger for trace logging (e.g., console, pino, Powertools Logger)</span><br/><span class="hl-1">  </span><span class="hl-5">logger:</span><span class="hl-1"> </span><span class="hl-5">console</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h2 id="stream-view-types" class="tsd-anchor-link">Stream View Types<a href="#stream-view-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Handler signatures adapt based on your DynamoDB stream configuration:</p>
<table>
<thead>
<tr>
<th>Stream View Type</th>
<th>INSERT</th>
<th>MODIFY</th>
<th>REMOVE</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>KEYS_ONLY</code></td>
<td><code>(keys, ctx)</code></td>
<td><code>(keys, ctx)</code></td>
<td><code>(keys, ctx)</code></td>
</tr>
<tr>
<td><code>NEW_IMAGE</code></td>
<td><code>(newImage, ctx)</code></td>
<td><code>(undefined, newImage, ctx)</code></td>
<td><code>(undefined, ctx)</code></td>
</tr>
<tr>
<td><code>OLD_IMAGE</code></td>
<td><code>(undefined, ctx)</code></td>
<td><code>(oldImage, undefined, ctx)</code></td>
<td><code>(oldImage, ctx)</code></td>
</tr>
<tr>
<td><code>NEW_AND_OLD_IMAGES</code></td>
<td><code>(newImage, ctx)</code></td>
<td><code>(oldImage, newImage, ctx)</code></td>
<td><code>(oldImage, ctx)</code></td>
</tr>
</tbody>
</table>
<h2 id="processing-results" class="tsd-anchor-link">Processing Results<a href="#processing-results" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">result</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">router</span><span class="hl-1">.</span><span class="hl-0">process</span><span class="hl-1">(</span><span class="hl-5">event</span><span class="hl-1">);</span><br/><span class="hl-3">// { processed: 10, succeeded: 9, failed: 1, errors: [...] }</span><br/><br/><span class="hl-3">// Or with partial batch failures for Lambda retry</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-8">result</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">router</span><span class="hl-1">.</span><span class="hl-0">process</span><span class="hl-1">(</span><span class="hl-5">event</span><span class="hl-1">, { </span><span class="hl-5">reportBatchItemFailures:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1"> });</span><br/><span class="hl-3">// { batchItemFailures: [{ itemIdentifier: &#39;sequence-number&#39; }] }</span>
</code><button type="button">Copy</button></pre>

<h2 id="api-reference" class="tsd-anchor-link">API Reference<a href="#api-reference" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="streamrouter" class="tsd-anchor-link">StreamRouter<a href="#streamrouter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">class</span><span class="hl-1"> </span><span class="hl-7">StreamRouter</span><span class="hl-1">&lt;</span><span class="hl-7">V</span><span class="hl-1"> </span><span class="hl-6">extends</span><span class="hl-1"> </span><span class="hl-7">StreamViewType</span><span class="hl-1"> = </span><span class="hl-2">&#39;NEW_AND_OLD_IMAGES&#39;</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-6">constructor</span><span class="hl-1">(</span><span class="hl-5">options</span><span class="hl-1">?: </span><span class="hl-7">StreamRouterOptions</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-0">onInsert</span><span class="hl-1">&lt;</span><span class="hl-7">T</span><span class="hl-1">&gt;(</span><span class="hl-5">matcher</span><span class="hl-1">, </span><span class="hl-5">handler</span><span class="hl-1">, </span><span class="hl-5">options</span><span class="hl-1">?): </span><span class="hl-7">HandlerRegistration</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onModify</span><span class="hl-1">&lt;</span><span class="hl-7">T</span><span class="hl-1">&gt;(</span><span class="hl-5">matcher</span><span class="hl-1">, </span><span class="hl-5">handler</span><span class="hl-1">, </span><span class="hl-5">options</span><span class="hl-1">?): </span><span class="hl-7">HandlerRegistration</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onRemove</span><span class="hl-1">&lt;</span><span class="hl-7">T</span><span class="hl-1">&gt;(</span><span class="hl-5">matcher</span><span class="hl-1">, </span><span class="hl-5">handler</span><span class="hl-1">, </span><span class="hl-5">options</span><span class="hl-1">?): </span><span class="hl-7">HandlerRegistration</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">use</span><span class="hl-1">(</span><span class="hl-5">middleware</span><span class="hl-1">): </span><span class="hl-7">this</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-0">process</span><span class="hl-1">(</span><span class="hl-5">event</span><span class="hl-1">, </span><span class="hl-5">options</span><span class="hl-1">?): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">ProcessingResult</span><span class="hl-1"> | </span><span class="hl-7">BatchItemFailuresResponse</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">processDeferred</span><span class="hl-1">(</span><span class="hl-5">sqsEvent</span><span class="hl-1">, </span><span class="hl-5">options</span><span class="hl-1">?): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">ProcessingResult</span><span class="hl-1"> | </span><span class="hl-7">BatchItemFailuresResponse</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="handlerregistration" class="tsd-anchor-link">HandlerRegistration<a href="#handlerregistration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-7">HandlerRegistration</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">// id: unique identifier for this deferred handler (used to match records in processDeferred)</span><br/><span class="hl-1">  </span><span class="hl-0">defer</span><span class="hl-1">(</span><span class="hl-5">id</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">, </span><span class="hl-5">options</span><span class="hl-1">?: { </span><span class="hl-5">queue</span><span class="hl-1">?: </span><span class="hl-7">string</span><span class="hl-1">; </span><span class="hl-5">delaySeconds</span><span class="hl-1">?: </span><span class="hl-7">number</span><span class="hl-1"> }): </span><span class="hl-7">StreamRouter</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onInsert</span><span class="hl-1">(...): </span><span class="hl-7">HandlerRegistration</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onModify</span><span class="hl-1">(...): </span><span class="hl-7">HandlerRegistration</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">onRemove</span><span class="hl-1">(...): </span><span class="hl-7">HandlerRegistration</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="handlercontext" class="tsd-anchor-link">HandlerContext<a href="#handlercontext" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-7">HandlerContext</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">eventName</span><span class="hl-1">: </span><span class="hl-2">&#39;INSERT&#39;</span><span class="hl-1"> | </span><span class="hl-2">&#39;MODIFY&#39;</span><span class="hl-1"> | </span><span class="hl-2">&#39;REMOVE&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">eventID</span><span class="hl-1">?: </span><span class="hl-7">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">eventSourceARN</span><span class="hl-1">?: </span><span class="hl-7">string</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="license" class="tsd-anchor-link">License<a href="#license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Apache-2.0</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#ddb-stream-router"><span>ddb-<wbr/>stream-<wbr/>router</span></a><ul><li><a href="#features"><span>Features</span></a></li><li><a href="#installation"><span>Installation</span></a></li><li><a href="#quick-start"><span>Quick <wbr/>Start</span></a></li><li><a href="#discriminator-matching"><span>Discriminator <wbr/>Matching</span></a></li><li><a href="#using-zod-schemas"><span>Using <wbr/>Zod <wbr/>Schemas</span></a></li><li><a href="#attribute-change-filtering"><span>Attribute <wbr/>Change <wbr/>Filtering</span></a></li><li><a href="#batch-processing"><span>Batch <wbr/>Processing</span></a></li><li><a href="#middleware"><span>Middleware</span></a></li><li><a href="#deferred-processing-sqs"><span>Deferred <wbr/>Processing (<wbr/>SQS)</span></a></li><li><a href="#global-tables-region-filtering"><span>Global <wbr/>Tables (<wbr/>Region <wbr/>Filtering)</span></a></li><li><a href="#configuration-options"><span>Configuration <wbr/>Options</span></a></li><li><a href="#stream-view-types"><span>Stream <wbr/>View <wbr/>Types</span></a></li><li><a href="#processing-results"><span>Processing <wbr/>Results</span></a></li><li><a href="#api-reference"><span>API <wbr/>Reference</span></a></li><li><ul><li><a href="#streamrouter"><span>Stream<wbr/>Router</span></a></li><li><a href="#handlerregistration"><span>Handler<wbr/>Registration</span></a></li><li><a href="#handlercontext"><span>Handler<wbr/>Context</span></a></li></ul></li><li><a href="#license"><span>License</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">@rogerchi/ddb-stream-router</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
